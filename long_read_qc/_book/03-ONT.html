<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 ONT | Long read Quality Control</title>
  <meta name="description" content="NEOF book for the Long read quality control workshop" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 ONT | Long read Quality Control" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/figures/NEOF.png" />
  <meta property="og:description" content="NEOF book for the Long read quality control workshop" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 ONT | Long read Quality Control" />
  
  <meta name="twitter:description" content="NEOF book for the Long read quality control workshop" />
  <meta name="twitter:image" content="/figures/NEOF.png" />

<meta name="author" content="Matthew Gemmell &amp; Helen Hipperson" />


<meta name="date" content="2021-06-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="figures/NEOF_favicon.png" type="image/x-icon" />
<link rel="prev" href="02-Intro.html"/>
<link rel="next" href="04-PB.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="https://neof.org.uk/" target="blank"><img src="figures/neof_small_logo.png"></a></li>
<li><a>Long read QC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="01-Long_read_QC.html"><a href="01-Long_read_QC.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="02-Intro.html"><a href="02-Intro.html"><i class="fa fa-check"></i><b>2</b> Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-Intro.html"><a href="02-Intro.html#the-data"><i class="fa fa-check"></i><b>2.1</b> The data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-ONT.html"><a href="03-ONT.html"><i class="fa fa-check"></i><b>3</b> ONT</a>
<ul>
<li class="chapter" data-level="3.1" data-path="03-ONT.html"><a href="03-ONT.html#file-formats"><i class="fa fa-check"></i><b>3.1</b> File formats</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="03-ONT.html"><a href="03-ONT.html#fast5"><i class="fa fa-check"></i><b>3.1.1</b> Fast5</a></li>
<li class="chapter" data-level="3.1.2" data-path="03-ONT.html"><a href="03-ONT.html#summary-file"><i class="fa fa-check"></i><b>3.1.2</b> Summary file</a></li>
<li class="chapter" data-level="3.1.3" data-path="03-ONT.html"><a href="03-ONT.html#bam-file"><i class="fa fa-check"></i><b>3.1.3</b> BAM file</a></li>
<li class="chapter" data-level="3.1.4" data-path="03-ONT.html"><a href="03-ONT.html#fastq-file"><i class="fa fa-check"></i><b>3.1.4</b> fastq file</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="03-ONT.html"><a href="03-ONT.html#basecalling"><i class="fa fa-check"></i><b>3.2</b> Basecalling</a></li>
<li class="chapter" data-level="3.3" data-path="03-ONT.html"><a href="03-ONT.html#qc-of-fastq-file"><i class="fa fa-check"></i><b>3.3</b> QC of fastq file</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="03-ONT.html"><a href="03-ONT.html#nanostat"><i class="fa fa-check"></i><b>3.3.1</b> NanoStat</a></li>
<li class="chapter" data-level="3.3.2" data-path="03-ONT.html"><a href="03-ONT.html#porechop"><i class="fa fa-check"></i><b>3.3.2</b> Porechop</a></li>
<li class="chapter" data-level="3.3.3" data-path="03-ONT.html"><a href="03-ONT.html#nanoplot"><i class="fa fa-check"></i><b>3.3.3</b> NanoPlot</a></li>
<li class="chapter" data-level="3.3.4" data-path="03-ONT.html"><a href="03-ONT.html#nanofilt"><i class="fa fa-check"></i><b>3.3.4</b> NanoFilt</a></li>
<li class="chapter" data-level="3.3.5" data-path="03-ONT.html"><a href="03-ONT.html#final-check"><i class="fa fa-check"></i><b>3.3.5</b> Final check</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-PB.html"><a href="04-PB.html"><i class="fa fa-check"></i><b>4</b> PacBio</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-PB.html"><a href="04-PB.html#file-formats-1"><i class="fa fa-check"></i><b>4.1</b> File formats</a></li>
<li class="chapter" data-level="4.2" data-path="04-PB.html"><a href="04-PB.html#continuous-long-reads"><i class="fa fa-check"></i><b>4.2</b> Continuous Long Reads</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="04-PB.html"><a href="04-PB.html#quality-check"><i class="fa fa-check"></i><b>4.2.1</b> Quality check</a></li>
<li class="chapter" data-level="4.2.2" data-path="04-PB.html"><a href="04-PB.html#filtering"><i class="fa fa-check"></i><b>4.2.2</b> Filtering</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="04-PB.html"><a href="04-PB.html#circular-consensus-sequences"><i class="fa fa-check"></i><b>4.3</b> Circular Consensus Sequences</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05-Practice.html"><a href="05-Practice.html"><i class="fa fa-check"></i><b>5</b> Practice</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05-Practice.html"><a href="05-Practice.html#ont-data"><i class="fa fa-check"></i><b>5.1</b> ONT data</a></li>
<li class="chapter" data-level="5.2" data-path="05-Practice.html"><a href="05-Practice.html#pacbio-data"><i class="fa fa-check"></i><b>5.2</b> PacBio data</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="06-Furter_resources.html"><a href="06-Furter_resources.html"><i class="fa fa-check"></i><b>A</b> Videos</a></li>
<li class="chapter" data-level="B" data-path="06-Furter_resources.html"><a href="06-Furter_resources.html#long-read-sequencing-resources"><i class="fa fa-check"></i><b>B</b> Long read sequencing resources</a></li>
<li class="chapter" data-level="C" data-path="06-Furter_resources.html"><a href="06-Furter_resources.html#pacbio-resources"><i class="fa fa-check"></i><b>C</b> PacBio resources</a></li>
<li class="chapter" data-level="D" data-path="06-Furter_resources.html"><a href="06-Furter_resources.html#ont-resources"><i class="fa fa-check"></i><b>D</b> ONT resources</a></li>
<li class="chapter" data-level="E" data-path="06-Furter_resources.html"><a href="06-Furter_resources.html#tools"><i class="fa fa-check"></i><b>E</b> Tools</a></li>
<li class="chapter" data-level="F" data-path="06-Furter_resources.html"><a href="06-Furter_resources.html#misc"><i class="fa fa-check"></i><b>F</b> Misc</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Long read Quality Control</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ont" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> ONT</h1>
<p><img src="figures/ONT_logo.png" width="60%" style="display: block; margin: auto;" /></p>
<p>In this section we are going to carry out a quick QC of ONT data using the tool suite NanoPack and the tool Porechop. For this we will use the fastq files.</p>
<div id="file-formats" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> File formats</h2>
<p><img src="figures/files.png" width="15%" style="display: block; margin: auto;" /></p>
<p>Although we will only be using fastq files for this tutorial it is important to know the other file formats you may encounter when working with ONT data.</p>
<div id="fast5" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Fast5</h3>
<p><img src="figures/fast5.png" width="10%" style="display: block; margin: auto;" /></p>
<p>The raw data from ONT machines come as Fast5 (.fast5) files. This contains the signal data from the pore which can be processed into more useful files.</p>
<p>Fast5 files can contain:</p>
<ul>
<li>Raw signal data</li>
<li>Run metadata</li>
<li>fastq-basecalls</li>
<li>Other additional analyses</li>
</ul>
<p>The Fast5 file format is an implementation of the HDF5 file format specifically for ONT sequencing data. For more information on Fast5 and a tool to interface with these types of file please see:
<a href="https://github.com/nanoporetech/ont_fast5_api" class="uri">https://github.com/nanoporetech/ont_fast5_api</a></p>
</div>
<div id="summary-file" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Summary file</h3>
<p>The MinION and GridION output a single sequencing summary file in addition to the Fast5 files. This file contains metdata which descirbes each sequenced read.</p>
<p>We will not use Fast5 or summary files for this tutorial as they are not needed most of the time. It is likely these files will not be intially provided to you by a sequencing service as they are very large. However, if you do require them you can always ask but be careful with how long the sequencing centre will retain your data.</p>
</div>
<div id="bam-file" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> BAM file</h3>
<p><img src="figures/bam.png" width="10%" style="display: block; margin: auto;" /></p>
<p>BAM files (.bam) are the binary version of SAM files (.sam).</p>
<ul>
<li>SAM stands for "Sequence Alignment/Map" (the B in BAM is Binary).</li>
<li>SAM files are tab delimited and contain alignment information.</li>
<li>BAM files are not human readable whilst SAM files are.</li>
<li>SAM files are larger than BAM.</li>
</ul>
<p>Generally programs that can work on SAM files can also work on BAM files. Due to the size difference it is preferable to store data in BAM format over SAM. Even though a BAM file is smaller than their matching SAM file, BAM files are still very large and can be &gt;100GB.</p>
<p>It can be useful to contain unaligned reads from sequencing machines (e.g. PacBio and ONT) in BAM files as they can contain more metadata in the header and per-record auxiliary tags compared to fastq files.</p>
<p>If you are working with SAM/BAM files the following link will prove useful:
<a href="https://www.htslib.org/" class="uri">https://www.htslib.org/</a></p>
<p>For more information on the SAM and BAM format please see:
<a href="https://samtools.github.io/hts-specs/SAMv1.pdf" class="uri">https://samtools.github.io/hts-specs/SAMv1.pdf</a></p>
</div>
<div id="fastq-file" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> fastq file</h3>
<p><img src="figures/fastq.png" width="10%" style="display: block; margin: auto;" /></p>
<p>The fastq file format is very consistent and so there is no real difference between fastq files for Illumina, PacBio, and ONT data.</p>
<p>All fastq files will contain a number of lines divisible by 4. This is because each entry/sequence will take up four lines consisting of the following information:</p>
<ol style="list-style-type: decimal">
<li>Header for fastq entry known as the fastq header.
<ul>
<li>This always begins with a <strong>'@'</strong></li>
<li>This is where you might see the most difference between different data. Different machines and different public databases will use different formats for fastq headers.</li>
</ul></li>
<li>Sequence content</li>
<li>Quality header
<ul>
<li>Always begins with a '+'. Sometimes also contains the same information as fastq header.<br />
</li>
</ul></li>
<li>Quality
<ul>
<li>Each base in the 2nd line will have a corresponding quality value in this line.</li>
<li>Note this uses Phred encoding, of which there are different formats. Most, if not all, new files will use Phred+33 but be careful if you are using older data as it may use a different one. See the "Encoding" section in the following link for more info: <a href="https://en.wikipedia.org/wiki/FASTQ_format" class="uri">https://en.wikipedia.org/wiki/FASTQ_format</a>.</li>
<li>NOTE: <strong>'@'</strong> can be used as a quality value.</li>
</ul></li>
</ol>
<p>An example of the information of one sequence/entry is:</p>
<p><strong>@Sequence 1</strong><br />
<strong>CTGTTAAATACCGACTTGCGTCAGGTGCGTGAACAACTGGGCCGCTTT</strong><br />
<strong>+</strong><br />
<strong>=&lt;&lt;&lt;=&gt;@@@ACDCBCDAC@BAA@BA@BBCBBDA@BB@&gt;CD@A@B?B@@</strong></p>
</div>
</div>
<div id="basecalling" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Basecalling</h2>
<p><img src="figures/guppy.png" width="15%" style="display: block; margin: auto;" /></p>
<p>In short, basecalling is the converting of ONT signals to bases and quality. This step converts the Fast5 files to BAM and/or fastq files.</p>
<p>There are many tools to carry out basecalling with ONT data. ONT sequencing machines carry this out with in built programs. However, if you are interested in the tools used for this the primary ones are Guppy and Albacore. Unfortunately it is quite hard to find information about these tools unless you own an ONT machine.</p>
<p>Basecalling with Guppy tutorial:</p>
<p><a href="https://denbi-nanopore-training-course.readthedocs.io/en/latest/basecalling/basecalling.html" class="uri">https://denbi-nanopore-training-course.readthedocs.io/en/latest/basecalling/basecalling.html</a></p>
<p>Basecalling with Albacore tutorial:</p>
<p><a href="https://denbi-nanopore-training-course.readthedocs.io/en/stable/basecalling/basecalling.html" class="uri">https://denbi-nanopore-training-course.readthedocs.io/en/stable/basecalling/basecalling.html</a></p>
</div>
<div id="qc-of-fastq-file" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> QC of fastq file</h2>
<p><img src="figures/qc_inspection.png" width="15%" style="display: block; margin: auto;" /></p>
<p>For this tutorial we will carry out quality control and checking on fastq files. Some QC steps can be carried out on summary files and/or BAM files. However we will be using fastq files for a variety of reasons:</p>
<ul>
<li>Fastq files are the smallest and so these processes will run quicker and the files will take up less storage. Ideal for a tutorial.</li>
<li>Fastq files are the easiest to work with.</li>
<li>You will most likely use fastq files in the future for ONT data.
<ul>
<li>If you get your data sequenced by a genomic centre they will most likely give you your data in demultiplexxed (one fastq file per sample) fastq files.</li>
<li>ONT machines generally come with in built basecalling and so will most likely provide fastq files as well as the other formats now.</li>
</ul></li>
</ul>
<p>Before carrying out any specific commands we will first move into the relevant directory.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="03-ONT.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/QC_workshop/ONT_QC/</span></code></pre></div>
<p>We need to initialise the environment to use the programs we need. This needs to be done in each terminal you want to run the below commands in. Each terminal will only remember what you have told that terminal.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="03-ONT.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span> usenanopack-1.1.0</span></code></pre></div>
<p>Look in the directory called data and you will notice there are a few directories. You can see the contents of all these directories with the below command.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="03-ONT.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> data/<span class="pp">*</span></span></code></pre></div>
<p>Each directory has one fastq file. ONT data likes to be organised with data for one sample being in one directory.</p>
<p>To start with we will only use the fastq file within the directory called "Acinetobacter". As you may have figured out, this contains ONT sequencing data of an Acinetobacter genome. Specifically the data is a subset of the SRA (Sequence Read Archive) Run: SRR7119550.</p>
<div id="nanostat" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> NanoStat</h3>
<p><img src="figures/metrics.png" width="15%" style="display: block; margin: auto;" /></p>
<p>The first step is to acquire stats for the sequences in our fastq file. We will use NanoStat (<a href="https://github.com/wdecoster/nanostat" class="uri">https://github.com/wdecoster/nanostat</a>).</p>
<p>NanoStat is one of the many tools contained in the NanoPack suite (<a href="https://github.com/wdecoster/nanopack" class="uri">https://github.com/wdecoster/nanopack</a>). We will also use the tools NanoPlot and NanoFilt downstream.</p>
<p>We want to have a tidy set of directories at the end of this analysis. It would be an untidy mess if we had all the output files in the current directory. We will therefore be making directories and subdirectories to send our output.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="03-ONT.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> nanostats</span></code></pre></div>
<p>Finally we will now run NanoStat. The options used are:</p>
<ul>
<li><code>-n</code> : File name/path for the output.</li>
<li><code>-t</code> : Number of threads the script can use.</li>
<li><code>--fastq</code> : Input data is in fastq format. Other options that can be used are <code>--fasta</code>, <code>--summary</code>, and <code>--bam</code>.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="03-ONT.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">NanoStat</span> <span class="at">-n</span> nanostats/Acinetobacter_nanostats.tsv <span class="dt">\</span></span>
<span id="cb8-2"><a href="03-ONT.html#cb8-2" aria-hidden="true" tabindex="-1"></a>-t 4 <span class="at">--fastq</span> ./data/Acinetobacter/Acinetobacter_genome_ONT.fastq</span></code></pre></div>
<p>Now we can look at the output text file. In this case we will use the convenient <code>less</code> command.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="03-ONT.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> nanostats/Acinetobacter_nanostats.tsv</span></code></pre></div>
<div id="nanostat-output-format" class="section level4" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> NanoStat output format</h4>
<p>The file contains four sections with informative headers. These are:</p>
<ol style="list-style-type: decimal">
<li><strong>General summary</strong>
<ul>
<li>A list of general summary metrics.</li>
</ul></li>
<li><strong>Number, percentage and megabases of reads above quality cutoffs</strong>
<ul>
<li>Based on the mean quality value of a read.</li>
<li>The "&gt;Q5" line shows the number and % of reads with a mean quality above Q5. It also shows the total amount of megabases these reads contain.</li>
</ul></li>
<li><strong>Top 5 highest mean basecall quality scores and their read lengths</strong>
<ul>
<li>Shows the top 5 reads with the highest mean quality scores.</li>
</ul></li>
<li><strong>Top 5 longest reads and their mean basecall quality score</strong>
<ul>
<li>Shows the top 5 longest reads.</li>
</ul></li>
</ol>
</div>
</div>
<div id="porechop" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Porechop</h3>
<p><img src="figures/porechop_logo_knife.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Porechop is a tool to find and remove adapters from ONT data (<a href="https://github.com/rrwick/Porechop" class="uri">https://github.com/rrwick/Porechop</a>). Adapters are artificial sequences essential for sequencing but of no biological value and so you will typically want them removed.</p>
<p>Porechop is no longer supported but it still works and there is no alternative for adapter removal. Depending on which basecaller was used on your data, adapter removal may have already been carried out. However, it is always best to run porechop if you are not sure.</p>
<p>Porechop has a list of known adapters it will look for and remove. These contain:</p>
<ul>
<li>Ligation kit adapters</li>
<li>Rapid kit adapters</li>
<li>PCR kit adapters</li>
<li>Barcodes</li>
<li>Native barcoding</li>
<li>Rapid barcoding</li>
</ul>
<p>Porechop will look for these adapters at the start and end of each read. Then it will look for adapters within the sequence (known as middle adapters to Porechop). If it finds a middle adapter it will conclude that the read is chimeric (a recombinant read containing sequence from 2 or more reads) and split the read. Depending on the number of middle adpaters the chimeric read may split into 2 or more reads.</p>
<p>With all that explanation we will now run Porechop. Thankfully the command is relatively straight forward with the options:</p>
<ul>
<li><code>-t</code>: Number of threads to be used.</li>
<li><code>-i</code>: Input path of a fasta file, fastq file, or a directory. If a directory is specified it will be recursively searched for fastq files.</li>
<li><code>-o</code>: Output path. This will either be a fastq or fasta file name.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="03-ONT.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create output directory</span></span>
<span id="cb10-2"><a href="03-ONT.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> porechop</span>
<span id="cb10-3"><a href="03-ONT.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Run porechop command</span></span>
<span id="cb10-4"><a href="03-ONT.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">porechop</span> <span class="at">-t</span> 4 <span class="at">-i</span> ./data/Acinetobacter/Acinetobacter_genome_ONT.fastq <span class="dt">\</span></span>
<span id="cb10-5"><a href="03-ONT.html#cb10-5" aria-hidden="true" tabindex="-1"></a>-o porechop/Acinetobacter.porechop.fastq</span></code></pre></div>
<p>Porechop will take a while to run. Whilst it is running, look at the screen output to get an idea of what it is doing. When finished, look at the bottom of the printed results.</p>
<p>Questions:</p>
<ul>
<li>How many reads had adapters trimmed from their start?</li>
<li>How many bases were removed by adapters being trimmed from the end of reads?</li>
<li>How many reads were split based on middle adpaters?</li>
</ul>
<p>For more uses of Porechop please see the below links:</p>
<ul>
<li><a href="https://github.com/rrwick/Porechop#quick-usage-examples" class="uri">https://github.com/rrwick/Porechop#quick-usage-examples</a></li>
<li><a href="https://github.com/rrwick/Porechop#full-usage" class="uri">https://github.com/rrwick/Porechop#full-usage</a></li>
</ul>
</div>
<div id="nanoplot" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> NanoPlot</h3>
<p><img src="figures/nanoplot_hexes.png" width="15%" style="display: block; margin: auto;" /></p>
<p>NanoPlot can be thought of as the FastQC for ONT data. It produces a lot of useful visualisations to investigate the quality of ONT sequencing data. It can be used for fastq, fasta, bam, and sequencing summary files. The link for its github page is: <a href="https://github.com/wdecoster/NanoPlot" class="uri">https://github.com/wdecoster/NanoPlot</a></p>
<p>ONT data has much lower quality scores than Illumina with Q10 being good. If you have enough coverage and length the low quality can be corrected by downstream processes not covered in this tutorial.</p>
<p>Prior to running NanoPlot we will make a directory for the NanoPlot output. As NanoPlot creates a lot of files, we'll make a subdirectory for the NanoPlot output for the porechopped data.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="03-ONT.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> nanoplot</span>
<span id="cb11-2"><a href="03-ONT.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> nanoplot/porechop</span></code></pre></div>
<p>Now to run NanoPlot. The options we will use are:</p>
<ul>
<li><code>-t</code>: Number of threads to be used.</li>
<li><code>--fastq</code>: Specifies the input path which is a fastq file.</li>
<li><code>-o</code>: Directory where the output will be created.</li>
<li><code>-p</code>: Prefix of output files. It is useful to have "_" at the end of the prefix.</li>
<li><code>--plots</code>: Specifies what type of bivariate plot is to be created (more on this later). I find <code>hex</code> to be the best.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="03-ONT.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">NanoPlot</span> <span class="at">-t</span> 4 <span class="dt">\</span></span>
<span id="cb12-2"><a href="03-ONT.html#cb12-2" aria-hidden="true" tabindex="-1"></a>--fastq porechop/Acinetobacter.porechop.fastq <span class="dt">\</span></span>
<span id="cb12-3"><a href="03-ONT.html#cb12-3" aria-hidden="true" tabindex="-1"></a>-o nanoplot/porechop <span class="at">-p</span> Acinetobacter_ <span class="dt">\</span></span>
<span id="cb12-4"><a href="03-ONT.html#cb12-4" aria-hidden="true" tabindex="-1"></a>--plots hex </span></code></pre></div>
<p>You may get the below warning. This is fine and can be ignored.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="03-ONT.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/pub37/matt/programs_chos_8/anaconda3/lib/python3.7/_collections_abc.py:702:</span> MatplotlibDeprecationWarning: The global colormaps dictionary is no longer considered public API.</span>
<span id="cb13-2"><a href="03-ONT.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="ex">len</span><span class="er">(</span><span class="ex">self._mapping</span><span class="kw">)</span></span>
<span id="cb13-3"><a href="03-ONT.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/pub37/matt/programs_chos_8/anaconda3/lib/python3.7/_collections_abc.py:720:</span> MatplotlibDeprecationWarning: The global colormaps dictionary is no longer considered public API.</span>
<span id="cb13-4"><a href="03-ONT.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">yield</span> from self._mapping</span></code></pre></div>
<p>List the files in the output directory.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="03-ONT.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> nanoplot/porechop/</span></code></pre></div>
<p>There are quite a few files. These should all start with "Acinetobacter_" thanks to the <code>-p</code> option. To quickly check all the results we can open the report html file with firefox.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="03-ONT.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">firefox</span> nanoplot/porechop/Acinetobacter_NanoPlot-report.html</span></code></pre></div>
<div id="nanoplot-output-format" class="section level4" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> NanoPlot output format</h4>
<p>The first section contains NanoStat output. Quickly look over this and see how it compares to the NanoStat output of the pre-porechopped reads.</p>
<p>Tip: To open a new terminal, right click VNC background -&gt; Applications -&gt; Shells -&gt; Bash.</p>
<p>After the <strong>Summary Statistics</strong> section there is a <strong>Plots</strong> section. This contains the plots:</p>
<ul>
<li><strong>Histogram of read lengths</strong>
<ul>
<li>Histogram of "Number of <em>reads</em>" (y) against "Read length" (x).</li>
</ul></li>
<li><strong>Histogram of read lengths after log transformations</strong>
<ul>
<li>Histogram of "Number of <em>reads</em>" (y) against log transformed "Read length" (x).</li>
</ul></li>
<li><strong>Weighted Histogram of read lengths</strong>
<ul>
<li>Histogram of "Number of <em>bases</em>" (y) against "Read length" (x).</li>
</ul></li>
<li><strong>Weighted Histogram of read lengths after log transformation</strong>
<ul>
<li>Histogram of "Number of <em>bases</em>" (y) against log transformed "Read length" (x).</li>
</ul></li>
<li><strong>Dynamic histogram of Read length</strong>
<ul>
<li>An interactive Histogram of "Number of reads" (y) against "Read length" (x) produced by plotly (<a href="https://plotly.com/" class="uri">https://plotly.com/</a>).</li>
<li>You can zoom into areas by clicking and dragging.
<ul>
<li>Make boxes to zoom into a specific area.</li>
<li>Click and drag left or right only to zoom into a specific part of the x axis.</li>
<li>Click and drag up or down only to zoom into a specific part of the y axis.</li>
<li>Click the home icon on the top right to reset the axes.</li>
</ul></li>
</ul></li>
<li><strong>Yield by length</strong>
<ul>
<li>Plot showing the "Cumulative yield for minimal length" (y) by "Read length" (x).</li>
<li>The cumulative yield is measured in Gigabases (billion bases).</li>
<li>This plot is useful to know how many bases you would retain if you filtered reads based on read length.</li>
</ul></li>
<li><strong>Read lengths vs Average read quality plot using hexagonal bins</strong>
<ul>
<li>This is the most informative plot. It is the bivariate plot we indicated we wanted as hexagonal with the option <code>--plots hex</code>.</li>
<li>Each hex is a bin with a darker colour representing more reads.</li>
<li>At the top of the plot is a histogram of Number of reads against read lengths.</li>
<li>At the right of the plot is a sideways histogram of number of reads against average read quality.</li>
</ul></li>
</ul>
<p>Questions to be answered with the html file:</p>
<ul>
<li>How long is the longest read?</li>
<li>What is the highest mean basecall quality score of a read?</li>
<li>How many reads have a mean basecall quality score &gt;Q10?</li>
<li>Approximately where is the highest density of reads in terms of read lengths and average read quality.</li>
<li>Roughly, do the longer reads have relatively high, medium, or low mean qualities?</li>
</ul>
<p>Using different input files will give you different plots. For more details please see the "Plots Generated" section on: <a href="https://github.com/wdecoster/NanoPlot" class="uri">https://github.com/wdecoster/NanoPlot</a>.</p>
</div>
</div>
<div id="nanofilt" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> NanoFilt</h3>
<p><img src="figures/quality_filtering.png" width="10%" style="display: block; margin: auto;" /></p>
<p>NanoFilt can be used to remove/filter reads by quality and/or read length (<a href="https://github.com/wdecoster/nanofilt" class="uri">https://github.com/wdecoster/nanofilt</a>). This is very useful as you will most likely want long and good quality reads for downstream processes, such as genome assemblies.</p>
<p>It is always important to know what your data is and if your planned filtering and trimming is appropriate. For example, you may be working with amplicon data where the read lengths will vary between 500bp and 750bp. In that case it is useful to set a min length of 500 and a maxlength of 750.</p>
<p>This data is from a genome so wanting long and high quality reads is appropriate. Overall quality looks good. The main exception is the low amount of sequencing/coverage. The low coverage is because it is a subset of the whole data for workshop purposes (the full dataset would take too long to run through). There are some shorter length and lower quality reads which we will remove.</p>
<p>First we will create an output directory.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="03-ONT.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> nanofilt</span></code></pre></div>
<p>We will filter out sequences that are shorter than 500bp (<code>-l 500bp</code>) and filter out sequences with a average read quality less than Q10 (<code>-q 10</code>). We have chosen these values as they are a good default for genomic data. Q10 appeared to be a good choice from NanoPlot as the majority of reads had a quality of &gt;Q10.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="03-ONT.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> porechop/Acinetobacter.porechop.fastq <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb17-2"><a href="03-ONT.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">NanoFilt</span> <span class="at">-l</span> 500 <span class="at">-q</span> 10 <span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb17-3"><a href="03-ONT.html#cb17-3" aria-hidden="true" tabindex="-1"></a>nanofilt/Acinetobacter.nanofiltq10minlen500.porechop.fastq</span></code></pre></div>
<p>Are the chosen options appropriate? Let's find out.</p>
</div>
<div id="final-check" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Final check</h3>
<p><img src="figures/finish.png" width="15%" style="display: block; margin: auto;" /></p>
<p>After trimming or filtering reads (quality control) it is always important to carry out a quality check. We will therefore run NanoPlot again.</p>
<p><strong>Note</strong>: We are using a long informative output directory name. This is important as we may need to rerun NanoFilt a few more times with different options until we are happy.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="03-ONT.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make an output directory before running NanoPlot</span></span>
<span id="cb18-2"><a href="03-ONT.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> nanoplot/nanofiltq10minlen500_porechop</span>
<span id="cb18-3"><a href="03-ONT.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Run NanoPlot on the fastq file with the filtered and porechopped data</span></span>
<span id="cb18-4"><a href="03-ONT.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">NanoPlot</span> <span class="at">-t</span> 4 <span class="dt">\</span></span>
<span id="cb18-5"><a href="03-ONT.html#cb18-5" aria-hidden="true" tabindex="-1"></a>--fastq nanofilt/Acinetobacter.nanofiltq10minlen500.porechop.fastq <span class="dt">\</span></span>
<span id="cb18-6"><a href="03-ONT.html#cb18-6" aria-hidden="true" tabindex="-1"></a>-o nanoplot/nanofiltq10minlen500_porechop/ <span class="at">-p</span> Acinetobacter_ <span class="dt">\</span></span>
<span id="cb18-7"><a href="03-ONT.html#cb18-7" aria-hidden="true" tabindex="-1"></a>--plots hex </span></code></pre></div>
<p>Now inspect the report</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="03-ONT.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">firefox</span> nanoplot/nanofiltq10minlen500_porechop/Acinetobacter_NanoPlot-report.html</span></code></pre></div>
<p>Ultimately when quality checking we need to take into account how much data we are left with. We need to make sure we have a good amount of bases and reads for our application. However, we also want to make sure we aren't left with a lot of poor quality data.</p>
<p>Depending on our application the quality of the reads may be less important, or the other way around. The is the same with the amount of reads and bases. What is needed will be clearer when you know what type of data you have. These considerations will be covered in our future workshops of the specific data types</p>
<p>A quick example is data for a genome assembly. For this type of analysis we will want our number of bases to reach a certain coverage. We'll want a decent quality but a high coverage can help overcome lower quality (more on this in a future workshop). Generally for ONT assemblies you will want 20X - 100X coverage with a higher coverage producing a better assembly (100x coverage= 100bp sequencing data per 1bp of the genome size). Higher coverages may be worse as it can be too much information for an assembly algorithm to cope with.</p>
<p>In addition to the amount of bases, the length of reads is also important. One read that is 10kbp long is most likely better than 10 reads that are each 1kbp long for a genome assembly. This is because less reads will need to be assembled.</p>
<p>Keeping all this in mind, let's say this sequencing is for a genome with a size of 0.5 Mbp (0.5 million base pairs). We want at least 20X coverage (i.e 10,000,000.0 total bases). Do we have this for the data that was porechopped and nanofiltered?</p>
<p>If not, try running NanoFilt with a different choices for <code>--q</code> until you do.</p>
<ul>
<li>What is an option that works to get the desired coverage?</li>
<li>Is the overall quality decent (Mean &amp; Median read quality &gt; 10)?</li>
<li>What is the N50 of your QC'd reads?</li>
<li>How many extra reads and bases did you retain compared to the Q10 filtering?</li>
</ul>
<p>Tips:</p>
<ul>
<li>Make sure your new output paths have unique names.</li>
<li>Use NanoPlot results to compare the Q10 filtering to your own. The NanoStat part is especially helpful.</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="02-Intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="04-PB.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
